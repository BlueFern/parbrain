parbrain - NVU 2.0 with extracellular diffusion
========
Parbrain stands for "parallel brain". This code generates a binary tree, which globally couples multiple neurovascular units (NVUs). The binary tree represents a vascular tree, which perfuses the cerebral tissue. It is laid out in such a way that it spatially fills a 2-dimensional tissue slice consisting of NVU blocks. The code computes the blood flow in the branches of the tree and the pressure in the nodes. The NVUs are located at the leaves of the tree and can (through smooth muscle activation/relaxation) control the vessel radii. 

NVU 2.0 contains the following pathways:
* Neuronal dynamics stimulated by a current input to the soma
* K+ pathway via K+ release from the neuron into the SC
* Nitric oxide pathway via glutamate release from the neuron into the SC
* Astrocytic calcium pathway via glutamate release from the neuron into the SC
* TRPV4 calcium channel on the astrocytic endfoot

The NVU model also contains extracellular space with diffusion of extracellular K+ and Na+ throughout the tissue block.

Inputs to the Model
===================
There are multiple inputs to the model coming from different "ends":

From the tissue:
----------------
* Current input to the neuron (soma) stimulates the following:
* neuronal K+ release/Na+ uptake
* neuronal Glu release -> activates NO production and astrocytic calcium release

From the vasculature:
---------------------
* pressure in the root vessel
* PLC production flux 


How to Compile
==============
Configure the project with CMake and specify the *out-of-source* build directory.

After the the project has been configured, it can be opened and compiled with the target IDE. Alternatively using Makefile configuration simply run make in the build directory. 

Requirements:
-------------
* VTK (for bin_to_vtu script which outputs vtu files for viewing in Paraview)
* CXsparse (for sparse matrices)
* MPI (for core to core communication)


How to Run
==========
`mpirun -np <number_of_processors> <directory>/parBrainSim <number_of_levels> <subtree_size> <final_time> <output per second>`

Where the program "parBrainSim" is located in the build directory. `<number_of_levels>` is the vascular tree size ,`<final_time>` is the final output time, and `<output per second>` is the number of times per second the data is saved. These are optional arguments. By default these are set in the constants.h file. 

This program outputs a directory `<data_directory>` with multiple data files (info.dat, tissueBlocks.dat, pressure.dat and flow.dat).
	

How to View Binary Data
================
`python <directory>/printData.py <data_directory>`

Where "printData.py" is located in the util subdirectory.
Prints out to the terminal: info, coordinates of the tissue block, state variables, flow and pressure for all timesteps.


Viewing in Paraview
==================

`<directory>/ConvertBinToVtu <data_directory> <final_time> <output per second>`

Where `<program>` is "ConvertBinToVtu" located in the build directory, `<data_directory>` is the directory generated by parBrainSim, `<final_time>` is the final output time, and `<output per second>` is the number of times per second the data is saved.

This will generate sets of vtu/vtp files in `<data_directory>` for the tissue blocks, H tree lines and tubes for each timestep. Open in Paraview for visualisation.


Required modules Power7:
------------------------
module load suitesparse/4.2.1_adv

module load vtk
